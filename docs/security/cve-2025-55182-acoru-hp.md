# acoru-hp: React Server Components 調査レポート (CVE-2025-55182 / CVE-2025-66478)

## Overview
- 本レポートは Vercel デプロイ対象「acoru-hp」に対する**読み取り専用のセキュリティ調査**であり、アプリの実行挙動は変更していません。
- 技術スタック: Next.js (App Router, TypeScript, pnpm)。Airtable などの REST API をサーバー側から取得する構成。
- 脆弱性概要: React Server Components (RSC) の実装不備により、特定条件でキャッシュ汚染・任意コード実行の恐れがある問題 (CVE-2025-55182 / Next.js CVE-2025-66478)。主に Next.js 15/16 系と React 19 系で RSC を用いるプロジェクトが影響を受けます。

## Detected Stack
- パッケージマネージャー: pnpm (pnpm-lock.yaml 確認済み)。
- Node.js ランタイム: next.config.ts やルート設定での上書きなし → Vercel の Node.js デフォルトを前提。
- バージョン一覧:
  - next: 16.0.5
  - react: 19.2.0
  - react-dom: 19.2.0
  - react-server-dom-* 系パッケージ: 未検出 (依存関係・ロックファイルともに該当なし)

## RSC & Routing Usage
- ルーティング: `src/app` 配下の App Router を使用。`layout.tsx` にルートレイアウトが存在し、全体がサーバーコンポーネントとしてレンダリングされます。
- データ取得: App Router のサーバーコンポーネント (`src/app/page.tsx` など) からサーバー専用ライブラリ (`src/lib/airtableNews.ts`, `src/lib/airtableCases.ts`) を通じて Airtable REST API を `fetch` しています。`"use client"` が付与されたクライアントコンポーネントは限定的で、RSC が主体。
- Server Actions / `"use server"`: 現状未使用。

## Risk Assessment
- Next.js 16.0.5 + React 19.2.0 は、RSC を利用する場合に CVE-2025-55182 / CVE-2025-66478 の影響範囲に該当します。
- App Router のサーバーコンポーネントが外部 API から動的データを取得しているため、RSC のキャッシュやシリアライズ経路を通過します。現行バージョンでは既知の修正が適用されておらず、アップグレードによるリスク低減が必要です。

## Upgrade Recommendation
- 互換性を優先し、同一メジャーでのパッチ適用を推奨します。
  - Next.js: 16 系なら **16.0.7 以降** (例: 16.0.7+) へ更新。
  - React / ReactDOM: 19.2.1 以降 (同系統のパッチ版) へ更新。
- 依存関係が `^` 指定のため、`pnpm up next@16.0.7 react@19.2.1 react-dom@19.2.1` などでロックを更新し、Preview デプロイで互換性確認を行ってください。

## Checklist for Next Steps
1. 依存関係を更新し、`pnpm install --frozen-lockfile` でロックを再生成。
2. `pnpm lint` と `pnpm build` で静的解析とビルドを実行。
3. Vercel Preview にデプロイし、トップページ・ニュース詳細・ケース一覧など動的データページを確認。
4. 問題なければ Production へ昇格。
